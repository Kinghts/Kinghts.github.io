{"name":"iview源码阅读笔记","keywords":"iview，源码","createAt":"2018-7-4","updateAt":"2018-7-4 17:51:20","brief":"<p><a href=\"https://www.iviewui.com/\">iview</a>是一套基于Vue的高质量组件库，在前端项目里用得比较多，所以阅读一下它的源代码，方便以后的debug和造轮子。本笔记基于<a href=\"https://github.com/iview/iview\">iview项目</a>的git分支v2.14.3</p>\n","content":"<!--keywords:iview，源码-->\n<!--create:2018-7-4-->\n<p><a href=\"https://www.iviewui.com/\">iview</a>是一套基于Vue的高质量组件库，在前端项目里用得比较多，所以阅读一下它的源代码，方便以后的debug和造轮子。本笔记基于<a href=\"https://github.com/iview/iview\">iview项目</a>的git分支v2.14.3。</p>\n<h2 id=\"iview-\">iview项目的代码结构</h2>\n<p>用一个思维导图描述下：\n<img src=\"./img/iview.jpg\" alt=\"img\"></p>\n<h2 id=\"iview-\">iview中的简单组件</h2>\n<p>以Button组件为例(路径src/components/button)，该组件的结构非常简单，即通过vue组件的props提供配置项，通过配置项动态生成class来调整组件的样式，核心代码：</p>\n<pre><code class=\"lang-html\">&lt;div :class=&quot;classes&quot;&gt;\n&lt;/div&gt;\n</code></pre>\n<pre><code class=\"lang-javascript\">computed: {\n    classes () {\n        return [\n            `${prefixCls}`,\n            {\n                [`${prefixCls}-${this.size}`]: !!this.size,\n                [`${prefixCls}-${this.shape}`]: !!this.shape,\n                [`${prefixCls}-vertical`]: this.vertical\n            }\n        ];\n    }\n}\n</code></pre>\n<h2 id=\"iview-\">iview中的复杂组件</h2>\n<p>以Select组件为例(路径src/components/select)，该组件的代码非常多，看起来比较复杂，但根据官方文档还是可以理清里面的逻辑的，基本结构如下图：\n<img src=\"./img/Select.jpg\" alt=\"img\"></p>\n<h3 id=\"select-\">Select的基础用法的逻辑</h3>\n<pre><code class=\"lang-html\">&lt;Select v-model=&quot;model&quot; style=&quot;width:200px&quot;&gt;\n    &lt;Option v-for=&quot;item in list&quot; :value=&quot;item.value&quot; :key=&quot;item.value&quot;&gt;{{ item.label }}&lt;/Option&gt;\n&lt;/Select&gt;\n</code></pre>\n<h4 id=\"-\">下拉菜单列表的生成</h4>\n<p>上述代码由Select组件和Option组件组成，在Select.vue文件里可以看出，选项的数据传递过程：</p>\n<pre><code class=\"lang-html\">Option组件 --&gt; slots.default --&gt; data.slotOptions --&gt; computed.selectOptions --&gt; Dropdown组件\n</code></pre>\n<h4 id=\"-\">选择列表中的选项</h4>\n<p>Select组件在mounted钩子方法里，注册了on-select-selected事件，该事件在Option组件的Select方法里触发：</p>\n<pre><code class=\"lang-javascript\">select () {\n    if (this.disabled) return false;\n\n    // dispatch方法让Select组件也触发了on-select-selected事件，\n    // 是在子组件中调用了父组件的方法，个人感觉这样的写法不太好\n    this.dispatch(&#39;iSelect&#39;, &#39;on-select-selected&#39;, {\n        value: this.value,\n        label: this.optionLabel,\n    });\n    this.$emit(&#39;on-select-selected&#39;, {\n        value: this.value,\n        label: this.optionLabel,\n    });\n}\n</code></pre>\n<p>Select组件在该事件触发后，由onOptionClick方法进行处理，更新value并收起下拉菜单。</p>\n<p>to be continued</p>\n"}